This is blocking #3054 and probably other PRs.
Am looking at this now.
