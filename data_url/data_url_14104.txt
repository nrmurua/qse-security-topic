Currently, the test from test_circuit_load_from_qpy.py contain multiple lines of code that are repeated throughout the file, as pointed out and discussed with @jakelishman in #11206 (comment). We should group these lines into a common function/class in order to remove the redundant code.
As far as I can tell, two options stand out to me:
Grouping the lines for the roundrip circuit retrieval already removes about 200 lines of redundant code.
I will open a PR with the refactoring, however, I would like to know which option is preferred here.
Sorry for the big delay here - we had some big events on at the start of December, and stuff got lost in the run-up to it.
We actually already have a little bit of option 1 already in place: QpyCircuitTestCase in test.qpy.test_circuit_load_from_qpy has an assert_roundtrip_equal method that does some of what you want already and can be expanded to include the deprecated bit properties.  I think it's probably better to use that - we can satisfy the need to run additional tests on the circuits either by adding everything into that method (if it should be upheld for all circuits) or by having that method return the round-tripped circuit, so individual test cases can run further tests if desired.
No problem! Regarding your last point, that's what I proposed in the second option, since I saw multiple tests tested the same properties (even though not all tests did that). I will open a PR with this as soon as I refactor this. Thanks for the input!
