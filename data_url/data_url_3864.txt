See tests/cc/test_looping.cq.
Jeroen implemented dependence analysis such that there is not automatically a barrier before and after any loop. I haven't reviewed that well enough and don't understand how that could be possible. I would have expected that before and after each loop body (so inside the while) there would be a barrier. This would cater for taking the iteration, i.e. the dependence graph cannot be circular so cannot represent the dependences between two successive iterations.
