The new 3.4.0 version of pyquil included a feature to avoid adding duplicate DEFCAL and DEFCAL MEASURE instructions to a program. However, the code that excluded duplicated did not account for the calibration being unique per-site. As such, large calibration programs over many qubits would be stripped down to one calibration instance of any type.
For example, if you had four RX gates (-pi, -pi/2, +pi/2, +pi) over 10 qubits, you should have 40x DEFCALs. Version 3.4.0 stripped this down to one. Similar behavior was seen for 2Q gates and MEASURE calibrations.
This is easiest to reproduce in a failing test, which I will do in an associated MR.
