I tried to solve one of the tasks in #841 using lambda expressions instead of library functions, and it turns out that %kata magic fails if the code in that cell contains a lambda expression. The error is Expecting only one Q# operation in code. Using the first one; it looks like behind the scenes the Q# compiler generates explicit operations/functions for lambda expressions that interfere with the operation/function lookup and replacement logic implemented in the %kata cell.
At a guess, the fix would require trying to replace all backend Q# callables with ones defined in the notebook cell instead of trying to figure out the one that corresponds to the task.
We will be migrating the Katas to the new QDK that will use a different infrastructure (see https://devblogs.microsoft.com/qsharp/introducing-the-azure-quantum-development-kit-preview/ for the announcement), so we won't continue to improve the existing infrastructure of Q# notebooks magics. Closing this issue as "won't fix".
