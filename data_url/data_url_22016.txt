On Sayma, the AD9154 JESD initialization sometimes fails with "bad SYNC" or "JESD ready timeout".
@enjoy-digital suspects that this may be because the clocks generated by the HMC830 are not clean (#860 (comment)).
@gkasprow can you check that?
@sbourdeauducq can you describe any additional conditions when it happens? During normal operation? While initialisation? The board is cold or hot? Any additional info will help to recreate the problem.
Does it happen on all boards? What is Tx signal level?
This is at initialization, though we don't know at the moment if the link is reliable afterwards when the initialization succeeds. The boards are hot and I don't know if it happens with a cold board. What @enjoy-digital was suggesting you check is whether the HMC830 outputs clean clocks or not.
@sbourdeauducq OK, I will check it with spectrum analyser. This could be a problem with PLL loop stability. Is the PLL locked all the time? I didn't investigate it because at the time there was no configuration available and I used some typical values to check if from HW point of view only.
My understanding of the HMC830 is that if the PLL unlocks, it will not automatically try to relock or it will do so only once (depending on a bit in a configuration register).
Please compile ARTIQ and test the HMC830 with the exact same settings that we have.
@enjoy-digital Maybe it is just m-labs/jesd204b#12? I thought that issue was fixed already.
@sbourdeauducq: i'm pretty sure all was fine with kcu105 + ad9154 fmc and also with my sayma_test design. I need to do more tests but a quick check of the generated clocks would be interesting.
@gkasprow Have you installed ARTIQ?
Now we are running with the HMC830 bypassed, and 1.2GHz sent directly to the DAC.
On some board power-cycles the initialization never completes...
And the errors are varied...
(I'm doing some tests of DAC synchronization, so I have a script that power-cycles and reloads the boards many times, and this hits a lot of bugs...)
@sbourdeauducq do you read back the PLL AND DAC chip registers after configuration?
1.2GHz sent directly to the DAC.
Are you driving single-ended or differential (using 180-deg RF splitter)?
I drove it single-ended (soldered a 50R resistor across one SMP). At >=1GHz anything between +0dBm and +10dBm is fine (IIRC, those chips can take up to 2Vpp single ended).
Are you driving single-ended or differential (using 180-deg RF splitter)?
Single-ended, see the email I sent to the list.
For same .bit loaded into RTM and AMC FPGAs sometimes I see varied behavior for repeatedly issuing artiq_flash -t sayma start.
@enjoy-digital I still see this problem regularly #861 (comment)
@sbourdeauducq: yes i also saw it. I think i also see it on the KCU105 + AD9154 so i'll investigate with this setup.
Fixed via m-labs/jesd204b@03718be.
Just went through a dozen Sayma restarts without seeing any bugs. Good!
Wow! Nice.
