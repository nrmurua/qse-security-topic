The parser is doing too much and needs to be rethinked. Here some ideas:
Comments?
https://github.com/jwoehr/nuqasm2 is sort of a proof of concept of this sort of thing. What next?
