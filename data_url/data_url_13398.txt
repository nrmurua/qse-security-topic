Add a return_type argument to generate_mirror_circuit as in

and handle conversions as in

Add tests for all supported program types.
Follow up to #859.
cc @DSamuel1
