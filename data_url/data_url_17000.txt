Following the suggestion in #601 (comment)
hopefully fixed in #3222, please review my solution
