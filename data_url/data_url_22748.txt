This was marked for compiler optimization.
Works fine here on Pipistrello. Here is the code converted to the new device API:
Do you still have problems with it?
As I remember, this was not a compiler optimization problem, but an instability problem. Might have been solved with the concurrent memory access correction.
Just tested OK on KC705 as well. Reopen if you still have problems.
