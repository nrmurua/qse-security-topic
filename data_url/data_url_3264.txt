In #1611 we discovered that Program.declarations should be treated as a view on Program.instructions, else there can be inconsistencies that cause troubles with some workflows. The implementation of Program.copy_everything_except_instructions() does not preserve this- it copies declarations but not instructions. The declarations member should also not be copied.
