assert_optimized() removes the difference between the before and after circuits in this test so it will pass even if the Z gate is not moved to the end.
Fixed by #411
