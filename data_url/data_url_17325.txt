Pulse commands supplied by the backend may be parameterized with some expression that includes math performed on parameters of the form P#. Examples of valid strings are
Currently, parameters are extracted by first sanitizing the untrusted string supplied by backends to only math and then passing to Sympy parser for parameter extraction as Sympy parsing is known to be unsafe due to its use of eval. Sanitization is notoriously hard to implement correctly, and while it currently is mostly sufficient as the majority of backends are assumed to be trusted.
Rather than using a sanitization + Sympy, a parser for the limited subset of math and expressions required should be implemented. This parser should output a Qiskit expression with parameters.
I found the cmd_def returns some fc phases in the format such as np.pi*0.5, and it returns ParametrizedSchedule because the value is classified as a parameter. Also, parameters such as -(P#) returns unsafe expression error. New parser should fix these bugs.
I have implemented shunting yard based math parser in pulse simulator. Maybe I can build some parser for cmd_def as well.
