This may follow easily from the work in #10226, but at the very least this issue requires additional tests to be written to verify that the function is working as expected.
Depends on #10223, #10224.
