I am running the following experiment with gateware and software at commit f077176, and looking at the SERDES TTL signals 422l and 422u on a scope. Our target is based off the kc705 NIST clock with some additional TTLs
The expected behaviour is that both the 422u and 422l TTLs should pulse together for 1 ms every 1 ms. Instead I see the 422u pulse correctly, but the 422l fail to switch off every other time in the loop, so that the pulses are now 3 ms wide. That is, I see that line 18 "self._422l.off()" only replaces line 17 "self._422l.on()" every other time in the loop. This problem occurs only when I schedule these two events (which act on the same TTL) at the same timestamp. The problem goes away when I introduce a delay between them.
The artiq_coreanalyzer trace shows the expected bug-free behaviour, which does not match reality (i.e. what is actually produced on the TTLs as measured by the scope). I believe the GUI does match reality.
Thanks! Also for the clean repro. I think I have seen this as well in December with Kasli (back then there were more pressing issues so I didn't isolate it). Therefore likely reproduced/ible and maybe SED-related.
@sbourdeauducq @jordens have either of you managed to reproduce this?
Yes. I believe I have seen this in December. I haven't reproduced it with your code. @sbourdeauducq is looking at it.
Can be minimized further and reproduced in simulation:
