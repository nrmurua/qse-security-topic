In writing documentation examples for #385 and fixing #386, I ran across a problem with the current implementation of tensor_contract. In particular, it assumes that the order of the tensor indices into Qobj.data is the same as the order in Qobj.dims, but this is true only for Qobj instances that do not act on vectorized operators. This problem occurs in two places: first, in the call to reshape, and second, in the arguments passed to _tensor_contract_dense. Notably, this issue does not affect code that contracts corresponding input/output pairs of rectangular superoperators, as is the case for the partial trace example, so I don't believe that the current examples are wrong. Rather, this will generate invalid results for less conventional examples of tensor contraction.
