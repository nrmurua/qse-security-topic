As I've been working on pyQuil support, I realized that to_quil is not available in cirq v0.8.2, the latest stable release. As such, I pip installed cirq-unstable, only to find that the benchmark tests errored due to UnfoldableCircuitError: Circuit contains non-unitary channels which are not terminal measurements and cannot be folded. The circuits produced by either version have identical reprs, but as I dug deeper I was able to pinpoint quantumlib/Cirq#3026 as the offending pull request. Might take me a bit to figure out what's truly going on, but maybe this will be more immediately apparent to others. In the meantime, I'm going to pin to the version of cirq-unstable (0.9.0.dev20200508234715) which has quil_output.py but not this breaking PR.
That's interesting, nice find @karalekas. If I had to guess I would say the meaning of has_mixture probably changed in the newer Cirq, so we may need to use a different method to test if a gate can be folded.
This is important for the first release as we'll want to support the newest stable Cirq version.
We could try to replace has_mixture(...) with not has_unitary(...).
This is the docs of has_unitary.
