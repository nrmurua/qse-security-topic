From https://dev.azure.com/qiskit-ci/qiskit-terra/_build/results?buildId=17021&view=logs&j=c36f2e0f-c9b4-5d6c-0a9a-bb54323ef157&t=c9849e48-bd8f-5b19-f5f8-0b7675dae500&l=5319 :
This looks like a repeat of #4606 I don't know what would have changed to cause this now though. We did fix it in #4656 and that isolated windows only fix was replaced by a more general fix in 8e4a366 but it wasn't failing on that PR or other open patches. We can add back the fix (or a similar one) from #4606 if needed, but it'd be good to understand what is going on
we should do circuit equivalence checking rather than checking qasm. (pointed out by @levbishop)
Well except that test isn't really about checking equivalence, the test that's failing is specifically testing to make sure that we can run circuit.qasm() on a circuit with a 2q unitary gate in it: https://github.com/Qiskit/qiskit-terra/blob/master/test/python/circuit/test_unitary.py#L248-L271 and that the decomposed unitary gets defined as a custom gate correctly in the qasm output. There are other tests that do an equivalence check to verify the decomposition and I agree that is the proper way to to test that.
