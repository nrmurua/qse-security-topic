I built qsim locally from this repo, also modifing the Makefile in order to build the cuQuantum files:
In fact in the local folder I have a "qsim_custatevec.cpython-39-x86_64-linux-gnu.so" file, but when I do "pip install ."  it does not copy over to "/usr/lib/python3.9/site-packages/qsimcirq/"
If I instantiate a simulator that tries to use custatevec it does not find it:
results in a "ValueError: cuStateVec GPU execution requested, but not supported. If your device has GPU support and the NVIDIA cuStateVec library is installed, you may need to compile qsim locally."
Everything works fine with just CUDA11 (gpu_mode=0)
I noticed that the Makefile tests fail, so it it not building correctly. It might be a problem with GCC 11?
Here is the make log:
pip install . uses the CMake build path. Changes to Makefiles or .so files generated by running make will not affect it. (FWIW, the logs above appear to only be warnings - do you know if the tests pass with the warnings disabled?)
That said, if you have the cuQuantum SDK installed, the CMake build process should automatically take cuQuantum into account. To pipe CUQUANTUM_DIR into CMake, you may need to export it by running:
(where [PATH_TO_CUQUANTUM_SDK] is replaced with the path to your cuQuantum installation)
@95-martin-orion have you read the log at all? the CUQUANTUM_DIR variable is set to "/home/rugantio/Downloads/cuquantum", you can see that it was correctly parsed.
The "make qsim-custatevec" contains only warnings that's right, this is the problem, that I'm referring to, because the tests that are supposed to check that everything was fine are running into errors (see the last 6 lines). why is libcustatevec.so.0 not detected?
@rugantio Try adding the cuQuantum libraries to your LD_LIBRARY_PATH, something like:
RE: CUQUANTUM_DIR, I'm just verifying the build conditions. Running CUQUANTUM_DIR=[PATH_TO_CUQUANTUM] would also cause echo $CUQUANTUM_DIR to print the expected path, but unless it was exported the variable may not be available to CMake or other tools.
My read on the errors is that make -C tests/ custatevec-tests stopped short of generating the .so file due to the warnings it encountered, which caused the subsequent errors during make -C tests/ run-custatevec-tests. Disabling warnings or using make -k {...} to keep going after warnings may resolve the issue.
Adding @sergeisakov for his experience running these tests, and input on fixing warnings.
@leofang thank you leo, linking the loader did solve the issue related to "make run-custatevec-tests", which now works fine and returns, correctly:
However there is still something wrong with the .so file installation (which at this point we can safely say that is independent of the tests). As I mentioned, I can find the qsim_custatevec.cpython-39-x86_64-linux-gnu.so in the local qsimcirc folder (@95-martin-orion so it seems that the ADD_SUBDIRECTORY(pybind_interface/custatevec) in the CMakeLists is executed correctly?), but then it is not moved to the python environment.
I can verify it also by running
results in a ModuleNotFoundError: No module named 'qsimcirq.qsim_custatevec'
