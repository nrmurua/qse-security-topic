the flatten helper is convenient and so it gets called mulitiple times. However, it adds up to 16% of the total time in the profiling done in #69. APS2Pattern still relies of the list of list for some heuristics but otherwise once we inject WAIT at the beginning of each sequence we should be able to flatten once
